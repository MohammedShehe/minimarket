<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lawgate Mini-Market — Admin Dashboard</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    :root{ 
      --brand: #2c5aa0; 
      --brand-light: #e8f0fe;
      --brand-dark: #1e3d72;
      --accent: #ff6b35;
      --accent-light: #ffe8e0;
      --success: #28a745;
      --warning: #ffc107;
      --danger: #dc3545;
      --muted: #6c757d;
      --light-bg: #f8fafc;
      --sidebar-width: 280px;
      --header-height: 70px;
      --border-radius: 16px;
      --border-radius-sm: 12px;
      --box-shadow: 0 8px 30px rgba(0,0,0,0.08);
      --box-shadow-lg: 0 15px 50px rgba(0,0,0,0.12);
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --gradient: linear-gradient(135deg, #2c5aa0 0%, #3a7bd5 100%);
    }
    
    * {
      box-sizing: border-box;
    }
    
    body{ 
      background: var(--light-bg); 
      font-family: 'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif;
      color: #2d3748;
      line-height: 1.6;
      overflow-x: hidden;
    }
    
    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: #a8a8a8;
    }
    
    /* Sidebar Styles */
    .sidebar{ 
      min-height: 100vh; 
      background: #fff; 
      border-right: 1px solid #e6e9ef; 
      position: fixed;
      width: var(--sidebar-width);
      z-index: 1000;
      overflow-y: auto;
      box-shadow: var(--box-shadow);
      transition: var(--transition);
      padding: 0;
    }
    
    .sidebar-header {
      padding: 2rem 1.5rem 1.5rem;
      border-bottom: 1px solid #eef2f7;
      background: var(--gradient);
      color: white;
      margin-bottom: 1rem;
    }
    
    .sidebar-header h4 {
      font-weight: 700;
      margin: 0;
      font-size: 1.4rem;
    }
    
    .sidebar-header .text-muted {
      color: rgba(255,255,255,0.8) !important;
    }
    
    .sidebar .nav-link{ 
      color: #4a5568;
      border-radius: var(--border-radius-sm);
      margin: 0.25rem 1rem;
      padding: 0.875rem 1rem;
      transition: var(--transition);
      font-weight: 500;
      border: none;
      position: relative;
      overflow: hidden;
    }
    
    .sidebar .nav-link::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 4px;
      background: var(--brand);
      transform: scaleY(0);
      transition: var(--transition);
      border-radius: 0 4px 4px 0;
    }
    
    .sidebar .nav-link:hover,
    .sidebar .nav-link.active {
      background-color: var(--brand-light);
      color: var(--brand);
      transform: translateX(5px);
    }
    
    .sidebar .nav-link.active::before {
      transform: scaleY(1);
    }
    
    .sidebar .nav-link i {
      width: 20px;
      text-align: center;
      margin-right: 12px;
      font-size: 1.1rem;
    }
    
    .main-content {
      margin-left: var(--sidebar-width);
      width: calc(100% - var(--sidebar-width));
      transition: var(--transition);
      background: var(--light-bg);
      min-height: 100vh;
    }
    
    @media (max-width: 991.98px) {
      .sidebar {
        transform: translateX(-100%);
        width: var(--sidebar-width);
        z-index: 1050;
      }
      
      .sidebar.mobile-open {
        transform: translateX(0);
      }
      
      .main-content {
        margin-left: 0;
        width: 100%;
      }
      
      .mobile-menu-btn {
        display: block !important;
      }
    }
    
    /* Card Styles */
    .card {
      border: none;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      transition: var(--transition);
      margin-bottom: 1.5rem;
      overflow: hidden;
    }
    
    .card:hover {
      box-shadow: var(--box-shadow-lg);
      transform: translateY(-5px);
    }
    
    .card-header {
      background-color: #fff;
      border-bottom: 1px solid #eef2f7;
      padding: 1.5rem 1.5rem 1rem;
      font-weight: 600;
      color: #2d3748;
      border-radius: var(--border-radius) var(--border-radius) 0 0 !important;
    }
    
    .card-body {
      padding: 1.5rem;
    }
    
    .stat-card { 
      padding: 1.75rem; 
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      transition: var(--transition);
      height: 100%;
      background: #fff;
      border: none;
      position: relative;
      overflow: hidden;
    }
    
    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: var(--gradient);
    }
    
    .stat-card:hover {
      transform: translateY(-8px);
      box-shadow: var(--box-shadow-lg);
    }
    
    .stat-card h3 {
      font-size: 2.25rem;
      margin-bottom: 0.5rem;
      color: var(--brand);
      font-weight: 700;
    }
    
    .stat-card h6 {
      font-size: 0.9rem;
      color: var(--muted);
      margin-bottom: 0.75rem;
      font-weight: 500;
    }
    
    .stat-card .icon {
      font-size: 2.5rem;
      color: var(--brand);
      margin-bottom: 1rem;
      opacity: 0.8;
    }
    
    /* Image Preview */
    .img-preview{ 
      width: 80px; 
      height: 80px; 
      object-fit: cover; 
      border-radius: var(--border-radius-sm); 
      border: 2px solid #e2e8f0;
      transition: var(--transition);
    }
    
    .img-preview:hover {
      transform: scale(1.08);
      border-color: var(--brand);
    }
    
    /* Cursor & Interactive */
    .cursor-pointer{ cursor:pointer }
    
    /* Badge Styles */
    .badge-status{ 
      font-size: 0.75rem;
      padding: 0.5rem 0.875rem;
      border-radius: 50px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .badge-plated { background-color: #e3f2fd; color: #1976d2; }
    .badge-packaging { background-color: #fff3e0; color: #f57c00; }
    .badge-transporting { background-color: #e8f5e8; color: #388e3c; }
    .badge-transported { background-color: #e3f2fd; color: #1565c0; }
    .badge-delivered { background-color: #e8f5e8; color: #2e7d32; }
    .badge-cancelled { background-color: #ffebee; color: #c62828; }
    .badge-returned { background-color: #fff3e0; color: #ef6c00; }
    
    /* Table Styles */
    .table-responsive{ 
      border-radius: var(--border-radius);
      overflow: hidden;
    }
    
    .table {
      border-collapse: separate;
      border-spacing: 0;
      margin: 0;
    }
    
    .table th {
      background-color: #f8fafc;
      font-weight: 600;
      color: #4a5568;
      border-bottom: 2px solid #e2e8f0;
      padding: 1.25rem 1rem;
      font-size: 0.875rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .table td {
      padding: 1.25rem 1rem;
      border-bottom: 1px solid #eef2f7;
      vertical-align: middle;
      font-size: 0.9rem;
    }
    
    .table tbody tr {
      transition: var(--transition);
    }
    
    .table tbody tr:hover {
      background-color: #f8fafc;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    
    /* Toast Container */
    .toast-container{ 
      position: fixed; 
      right: 20px; 
      bottom: 20px; 
      z-index: 1055;
    }
    
    /* Button Styles */
    .btn {
      border-radius: var(--border-radius-sm);
      font-weight: 600;
      padding: 0.75rem 1.5rem;
      transition: var(--transition);
      border: none;
      font-size: 0.9rem;
    }
    
    .btn-primary {
      background: var(--gradient);
      border: none;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(44, 90, 160, 0.3);
    }
    
    .btn-sm {
      padding: 0.5rem 1rem;
      font-size: 0.8rem;
    }
    
    /* Modal Styles */
    .modal-content {
      border: none;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow-lg);
    }
    
    .modal-header {
      background-color: #f8fafc;
      border-bottom: 1px solid #eef2f7;
      padding: 1.5rem;
      border-radius: var(--border-radius) var(--border-radius) 0 0;
    }
    
    .modal-title {
      font-weight: 700;
      color: #2d3748;
      font-size: 1.25rem;
    }
    
    .modal-body {
      padding: 1.5rem;
    }
    
    .modal-footer {
      padding: 1.25rem 1.5rem;
      border-top: 1px solid #eef2f7;
    }
    
    /* Typography */
    h3, h4, h5, h6 {
      color: #2d3748;
      font-weight: 700;
    }
    
    /* Form Styles */
    .form-control, .form-select {
      border-radius: var(--border-radius-sm);
      padding: 0.875rem 1rem;
      border: 2px solid #e2e8f0;
      transition: var(--transition);
      font-size: 0.9rem;
    }
    
    .form-control:focus, .form-select:focus {
      border-color: var(--brand);
      box-shadow: 0 0 0 0.25rem rgba(44, 90, 160, 0.15);
    }
    
    .input-group-text {
      border-radius: var(--border-radius-sm);
    }
    
    /* Dashboard Header */
    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      flex-wrap: wrap;
      gap: 1rem;
    }
    
    .dashboard-title {
      font-size: 2rem;
      font-weight: 800;
      color: #2d3748;
      margin: 0;
      background: var(--gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    /* Mobile Menu Button */
    .mobile-menu-btn {
      display: none;
      background: var(--gradient);
      border: none;
      border-radius: var(--border-radius-sm);
      color: white;
      padding: 0.75rem;
      font-size: 1.25rem;
      transition: var(--transition);
    }
    
    .mobile-menu-btn:hover {
      transform: scale(1.05);
    }
    
    /* Ads Grid */
    .ads-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1.5rem;
    }
    
    .ad-card {
      border-radius: var(--border-radius);
      overflow: hidden;
      box-shadow: var(--box-shadow);
      transition: var(--transition);
      background: white;
    }
    
    .ad-card:hover {
      transform: translateY(-8px);
      box-shadow: var(--box-shadow-lg);
    }
    
    .ad-card img {
      width: 100%;
      height: 160px;
      object-fit: cover;
    }
    
    .ad-card-body {
      padding: 1.25rem;
    }
    
    /* Announcements */
    .announcement-item {
      border-radius: var(--border-radius);
      border: 1px solid #eef2f7;
      padding: 1.5rem;
      margin-bottom: 1rem;
      transition: var(--transition);
      background: white;
    }
    
    .announcement-item:hover {
      border-color: var(--brand-light);
      background-color: #f8fafc;
      transform: translateY(-3px);
    }
    
    /* Order Status Progress */
    .order-status-bar {
      display: flex;
      justify-content: space-between;
      margin-bottom: 2rem;
      position: relative;
      padding: 0 1rem;
    }
    
    .order-status-bar::before {
      content: '';
      position: absolute;
      top: 20px;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--brand) 0%, #e2e8f0 100%);
      z-index: 1;
      border-radius: 2px;
    }
    
    .order-status-step {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      z-index: 2;
      flex: 1;
    }
    
    .order-status-bubble {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: #e2e8f0;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 0.75rem;
      font-size: 1rem;
      color: #718096;
      transition: var(--transition);
      border: 3px solid white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .order-status-step.active .order-status-bubble {
      background-color: var(--brand);
      color: white;
      transform: scale(1.1);
    }
    
    .order-status-label {
      font-size: 0.8rem;
      color: #718096;
      text-align: center;
      font-weight: 500;
    }
    
    .order-status-step.active .order-status-label {
      color: var(--brand);
      font-weight: 700;
    }
    
    /* Loading Spinner */
    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Animation for page transitions */
    .tab-pane {
      animation: fadeIn 0.4s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Stock Display */
    .stock-display {
      font-weight: 600;
      padding: 0.5rem 1rem;
      border-radius: var(--border-radius-sm);
      text-align: center;
      display: inline-block;
    }
    
    .stock-high { background: #e8f5e8; color: #2e7d32; }
    .stock-medium { background: #fff3e0; color: #f57c00; }
    .stock-low { background: #ffebee; color: #c62828; }
    
    /* Responsive Design Improvements */
    @media (max-width: 767.98px) {
      .dashboard-header {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .dashboard-title {
        font-size: 1.75rem;
      }
      
      .stat-card {
        padding: 1.5rem;
      }
      
      .stat-card h3 {
        font-size: 1.75rem;
      }
      
      .table-responsive {
        font-size: 0.8rem;
      }
      
      .btn-group-vertical .btn {
        margin-bottom: 0.5rem;
      }
      
      .modal-dialog {
        margin: 0.5rem;
      }
      
      .toast-container {
        right: 10px;
        bottom: 10px;
        left: 10px;
      }
      
      .ads-grid {
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 1rem;
      }
      
      .order-status-bar {
        flex-direction: column;
        gap: 1rem;
        align-items: flex-start;
      }
      
      .order-status-bar::before {
        display: none;
      }
      
      .order-status-step {
        flex-direction: row;
        gap: 1rem;
        width: 100%;
      }
      
      .order-status-bubble {
        margin-bottom: 0;
      }
    }
    
    @media (max-width: 575.98px) {
      .main-content {
        padding: 1rem;
      }
      
      .card-body {
        padding: 1rem;
      }
      
      .stat-card {
        padding: 1.25rem;
      }
      
      .table td, .table th {
        padding: 0.875rem 0.5rem;
      }
      
      .btn {
        padding: 0.625rem 1.25rem;
      }
    }
    
    /* Custom Utilities */
    .glass-effect {
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .text-gradient {
      background: var(--gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .shadow-custom {
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <!-- Mobile Menu Button -->
  <button class="mobile-menu-btn position-fixed top-3 start-3 z-1050" id="mobileMenuBtn">
    <i class="fas fa-bars"></i>
  </button>

  <div class="container-fluid p-0">
    <div class="row g-0">
      <!-- SIDEBAR -->
      <nav class="sidebar d-flex flex-column" id="sidebar">
        <div class="sidebar-header">
          <h4 class="d-flex align-items-center">
            <i class="fa fa-store me-3"></i>
            <span>Lawgate Mini-Market</span>
          </h4>
          <small class="text-muted">Admin Dashboard</small>
        </div>
        <ul class="nav flex-column flex-grow-1 pt-3">
          <li class="nav-item"><a class="nav-link active" href="#dashboard" data-bs-toggle="tab"><i class="fa fa-tachometer-alt"></i> Dashboard</a></li>
          <li class="nav-item"><a class="nav-link" href="#products" data-bs-toggle="tab"><i class="fa fa-boxes"></i> Products</a></li>
          <li class="nav-item"><a class="nav-link" href="#customers" data-bs-toggle="tab"><i class="fa fa-users"></i> Customers</a></li>
          <li class="nav-item"><a class="nav-link" href="#ads" data-bs-toggle="tab"><i class="fa fa-bullhorn"></i> Ads & Announce</a></li>
          <li class="nav-item"><a class="nav-link" href="#notifications" data-bs-toggle="tab"><i class="fa fa-envelope"></i> Notifications</a></li>
          <li class="nav-item"><a class="nav-link" href="#orders" data-bs-toggle="tab"><i class="fa fa-shopping-cart"></i> Placed Orders</a></li>
        </ul>
        <div class="sidebar-footer p-3 mt-auto">
          <button class="btn btn-outline-primary btn-sm w-100" id="refreshDataBtn">
            <i class="fa fa-refresh me-2"></i> Refresh Data
          </button>
        </div>
      </nav>

      <!-- MAIN -->
      <main class="main-content py-4 px-4">
        <div class="tab-content">

          <!-- DASHBOARD -->
          <div class="tab-pane fade show active" id="dashboard">
            <div class="dashboard-header">
              <h3 class="dashboard-title">Dashboard Overview</h3>
              <div class="d-flex align-items-center gap-3">
                <span class="text-muted"><i class="fa fa-calendar me-2"></i><span id="currentDate"></span></span>
                <button class="btn btn-outline-primary btn-sm" id="refreshStatsBtn">
                  <i class="fa fa-refresh me-2"></i> Refresh Stats
                </button>
              </div>
            </div>

            <div class="row g-4 mb-5">
              <div class="col-6 col-md-3">
                <div class="stat-card">
                  <div class="icon text-primary">
                    <i class="fa fa-users"></i>
                  </div>
                  <h6 class="text-muted">Total Customers</h6>
                  <h3 id="totalUsers">0</h3>
                  <small class="text-success"><i class="fa fa-arrow-up me-1"></i> Updated just now</small>
                </div>
              </div>
              <div class="col-6 col-md-3">
                <div class="stat-card">
                  <div class="icon text-success">
                    <i class="fa fa-box"></i>
                  </div>
                  <h6 class="text-muted">Total Products</h6>
                  <h3 id="totalProducts">0</h3>
                  <small class="text-success"><i class="fa fa-arrow-up me-1"></i> Updated just now</small>
                </div>
              </div>
              <div class="col-6 col-md-3">
                <div class="stat-card">
                  <div class="icon text-warning">
                    <i class="fa fa-rupee-sign"></i>
                  </div>
                  <h6 class="text-muted">Total Income</h6>
                  <h3 id="totalIncome">₹0</h3>
                  <small class="text-success"><i class="fa fa-arrow-up me-1"></i> Updated just now</small>
                </div>
              </div>
              <div class="col-6 col-md-3">
                <div class="stat-card">
                  <div class="icon text-info">
                    <i class="fa fa-shopping-cart"></i>
                  </div>
                  <h6 class="text-muted">Total Orders</h6>
                  <h3 id="totalOrders">0</h3>
                  <small class="text-success"><i class="fa fa-arrow-up me-1"></i> Updated just now</small>
                </div>
              </div>
            </div>

            <div class="row g-4">
              <div class="col-lg-8">
                <div class="card">
                  <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Monthly Income Analytics</h5>
                    <div class="dropdown">
                      <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                        Last 12 Months
                      </button>
                    </div>
                  </div>
                  <div class="card-body">
                    <canvas id="incomeChart" height="100"></canvas>
                  </div>
                </div>
              </div>
              <div class="col-lg-4">
                <div class="card">
                  <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Recent Orders</h5>
                    <a href="#orders" class="btn btn-sm btn-outline-primary" data-bs-toggle="tab">View All</a>
                  </div>
                  <div class="card-body p-0">
                    <div class="list-group list-group-flush" id="recentOrdersList">
                      <!-- Recent orders will be populated here -->
                    </div>
                  </div>
                </div>
              </div>
            </div>

          </div>

          <!-- PRODUCTS -->
          <div class="tab-pane fade" id="products">
            <div class="dashboard-header">
              <h3 class="dashboard-title">Product Management</h3>
              <div>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#productModal" id="addProductBtn">
                  <i class="fa fa-plus me-2"></i> Add New Product
                </button>
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">Product Inventory</h5>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-hover" id="productsTable">
                    <thead>
                      <tr>
                        <th>#</th>
                        <th>Preview</th>
                        <th>Product Name</th>
                        <th>Price</th>
                        <th>Offer</th>
                        <th>Category</th>
                        <th>Stock</th>
                        <th>Status</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>

          </div>

          <!-- CUSTOMERS -->
          <div class="tab-pane fade" id="customers">
            <div class="dashboard-header">
              <h3 class="dashboard-title">Customer Management</h3>
              <div>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#customerModal" id="addCustomerBtn">
                  <i class="fa fa-user-plus me-2"></i> Add Customer
                </button>
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">Customer Directory</h5>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-hover" id="customersTable">
                    <thead>
                      <tr>
                        <th>#</th>
                        <th>Customer Name</th>
                        <th>Mobile</th>
                        <th>Email</th>
                        <th>Join Date</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>

          </div>

          <!-- ADS -->
          <div class="tab-pane fade" id="ads">
            <div class="dashboard-header">
              <h3 class="dashboard-title">Marketing & Communications</h3>
              <div class="btn-group">
                <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#adModal">
                  <i class="fa fa-image me-2"></i> Create Ad
                </button>
                <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#announcementModal">
                  <i class="fa fa-bullhorn me-2"></i> Post Announcement
                </button>
              </div>
            </div>

            <div class="card mb-4">
              <div class="card-header">
                <h5 class="mb-0">Active Advertisement Campaigns</h5>
              </div>
              <div class="card-body">
                <div class="ads-grid" id="adsList"></div>
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">Recent Announcements</h5>
              </div>
              <div class="card-body">
                <div id="announcementsList"></div>
              </div>
            </div>

          </div>

          <!-- NOTIFICATIONS -->
          <div class="tab-pane fade" id="notifications">
            <div class="dashboard-header">
              <h3 class="dashboard-title">Customer Communications</h3>
              <div class="btn-group">
                <button class="btn btn-primary" id="sendBroadcastBtn">
                  <i class="fa fa-paper-plane me-2"></i> Quick Broadcast
                </button>
                <button class="btn btn-outline-primary" id="sendToCustomerBtn">
                  <i class="fa fa-user me-2"></i> Send to Customer
                </button>
              </div>
            </div>

            <div class="card mb-4">
              <div class="card-header">
                <h5 class="mb-0">Customer Messages & Inquiries</h5>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table" id="messagesTable">
                    <thead>
                      <tr>
                        <th>#</th>
                        <th>Customer</th>
                        <th>Contact</th>
                        <th>Message Preview</th>
                        <th>Date</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">Send Broadcast Message</h5>
              </div>
              <div class="card-body">
                <form id="sendMessageForm" class="row g-3">
                  <div class="col-md-8">
                    <input class="form-control" id="messageSubject" placeholder="Message Subject (optional)" />
                  </div>
                  <div class="col-12">
                    <textarea class="form-control" id="messageBody" rows="4" placeholder="Write your message to send to all customers..."></textarea>
                  </div>
                  <div class="col-12">
                    <button class="btn btn-primary" type="submit">
                      <i class="fa fa-paper-plane me-2"></i> Send to All Customers
                    </button>
                  </div>
                </form>
              </div>
            </div>

          </div>

          <!-- ORDERS -->
          <div class="tab-pane fade" id="orders">
            <div class="dashboard-header">
              <h3 class="dashboard-title">Order Management</h3>
              <div class="d-flex align-items-center gap-2">
                <span class="badge bg-primary">Live Updates</span>
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">All Customer Orders</h5>
              </div>
              <div class="card-body table-responsive">
                <table class="table" id="ordersTable">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>Order ID</th>
                      <th>Customer</th>
                      <th>Product</th>
                      <th>Amount</th>
                      <th>Status</th>
                      <th>Date</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>

          </div>

        </div>
      </main>

    </div>
  </div>

  <!-- MODALS -->
  <!-- Product Modal -->
  <div class="modal fade" id="productModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <form id="productForm" enctype="multipart/form-data">
          <div class="modal-header">
            <h5 class="modal-title" id="productModalTitle">Add New Product</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <input type="hidden" id="productId" />
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Product Name *</label>
                <input class="form-control" id="productName" name="name" placeholder="Enter product name" required />
              </div>
              <div class="col-md-3">
                <label class="form-label">Price (₹) *</label>
                <input class="form-control" id="productPrice" name="price" type="number" placeholder="0.00" required min="0" step="0.01" />
              </div>
              <div class="col-md-3">
                <label class="form-label">Discount %</label>
                <input class="form-control" id="productOffer" name="offer_percent" type="number" placeholder="0" min="0" max="100" />
              </div>

              <div class="col-md-6">
                <label class="form-label">Brand</label>
                <input class="form-control" id="productBrand" name="brand" placeholder="Brand name" />
              </div>
              <div class="col-md-6">
                <label class="form-label">Category *</label>
                <select class="form-select" id="productCategory" name="category" required>
                  <option value="">Select Category</option>
                  <option value="clothing">Clothing</option>
                  <option value="electronics">Electronics</option>
                  <option value="groceries">Groceries</option>
                  <option value="home">Home & Kitchen</option>
                  <option value="beauty">Beauty</option>
                  <option value="sports">Sports</option>
                </select>
              </div>

              <div class="col-12">
                <label class="form-label">Product Images (max 5 images)</label>
                <input class="form-control" id="productImages" name="images[]" type="file" accept="image/*" multiple />
                <div class="form-text">Recommended size: 800x800px. First image will be featured.</div>
                <div class="mt-3 d-flex flex-wrap gap-2" id="imagePreview"></div>
              </div>

              <div class="col-md-6">
                <label class="form-label">Available Colors</label>
                <input class="form-control" id="productColors" name="color" placeholder="e.g. Red, Blue, Black" />
              </div>
              <div class="col-md-6">
                <label class="form-label">Materials</label>
                <input class="form-control" id="productMaterials" name="material" placeholder="e.g. Cotton, Polyester" />
              </div>

              <div class="col-md-6">
                <label class="form-label">Available Sizes</label>
                <input class="form-control" id="productSizes" name="available_sizes" placeholder="S, M, L, XL" />
              </div>
              <div class="col-md-3">
                <label class="form-label">Stock Quantity</label>
                <input class="form-control" id="productStock" name="stock" type="number" min="0" value="1" />
              </div>
              <div class="col-md-3">
                <label class="form-label">SKU Code</label>
                <input class="form-control" id="productSKU" placeholder="SKU123" />
              </div>

              <div class="col-12">
                <label class="form-label">Product Description</label>
                <textarea id="productDesc" name="description" class="form-control" rows="4" placeholder="Describe the product features and details..."></textarea>
              </div>

            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary" id="saveProductBtn">Save Product</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Customer Modal -->
  <div class="modal fade" id="customerModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <form id="customerForm">
          <div class="modal-header">
            <h5 class="modal-title">Add New Customer</h5>
            <button class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <input type="hidden" id="customerId" />
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">First Name *</label>
                <input id="custFname" name="first_name" class="form-control" placeholder="First Name" required />
              </div>
              <div class="col-md-6">
                <label class="form-label">Last Name *</label>
                <input id="custLname" name="last_name" class="form-control" placeholder="Last Name" required />
              </div>
              <div class="col-12">
                <label class="form-label">Mobile Number *</label>
                <input id="custMobile" name="mobile_no" class="form-control" placeholder="Mobile Number" required />
              </div>
              <div class="col-12">
                <label class="form-label">Email Address</label>
                <input id="custEmail" name="email" class="form-control" placeholder="email@example.com" type="email" />
              </div>
              <div class="col-12">
                <label class="form-label">Password *</label>
                <input id="custPassword" name="password" type="password" class="form-control" placeholder="Create password" required />
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button class="btn btn-primary" type="submit">Save Customer</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Ad Modal -->
  <div class="modal fade" id="adModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <form id="adForm" enctype="multipart/form-data">
          <div class="modal-header">
            <h5 class="modal-title">Create New Advertisement</h5>
            <button class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label class="form-label">Destination URL</label>
              <input class="form-control" id="adLink" name="link" placeholder="https://example.com (optional)" />
            </div>
            <div class="mb-3">
              <label class="form-label">Advertisement Image *</label>
              <input class="form-control" id="adImage" name="image" type="file" accept="image/*" required />
              <div class="form-text">Recommended: 1200x600px for best display</div>
            </div>
            <div class="text-center">
              <img id="adPreview" class="img-fluid rounded d-none mt-3 shadow" style="max-height: 200px;" />
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button class="btn btn-success" type="submit">Publish Ad</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Announcement Modal -->
  <div class="modal fade" id="announcementModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <form id="announcementForm">
          <div class="modal-header">
            <h5 class="modal-title">Create Announcement</h5>
            <button class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <label class="form-label">Announcement Message *</label>
            <textarea id="announcementText" name="message" class="form-control" rows="4" placeholder="Type your announcement message here..." required></textarea>
            <div class="form-text">This message will be visible to all customers.</div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button class="btn btn-primary" type="submit">Post Announcement</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Send to Customer Modal -->
  <div class="modal fade" id="sendToCustomerModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <form id="sendToCustomerForm">
          <div class="modal-header">
            <h5 class="modal-title">Send Message to Customer</h5>
            <button class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label class="form-label">Select Customer *</label>
              <select class="form-select" id="selectedCustomer" name="user_id" required>
                <option value="">-- Select Customer --</option>
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label">Subject</label>
              <input type="text" class="form-control" id="customerMessageSubject" name="subject" placeholder="Message subject (optional)">
            </div>
            <div class="mb-3">
              <label class="form-label">Message *</label>
              <textarea class="form-control" id="customerMessageBody" name="message" rows="4" placeholder="Write your personalized message..." required></textarea>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button class="btn btn-primary" type="submit">Send Message</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- OTP Modal -->
  <div class="modal fade" id="otpModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Confirm Delivery</h5>
          <button class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="text-center mb-4">
            <i class="fa fa-shield-alt fa-3x text-primary mb-3"></i>
            <h6>Enter Delivery OTP</h6>
          </div>
          <p id="otpInfo" class="text-center text-muted mb-3"></p>
          <input id="otpInput" class="form-control form-control-lg text-center" placeholder="Enter OTP" />
          <div class="form-text text-center">Enter the OTP sent to the customer to confirm delivery.</div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-primary" id="confirmOtpBtn">Confirm Delivery</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast container -->
  <div class="toast-container"></div>

  <script>
    // API Configuration
    const API_BASE = 'http://localhost/lawgate_mini_market/admin';
    
    // Utility functions
    function showToast(msg, type = 'success', delay = 4000) {
      const cont = document.querySelector('.toast-container');
      const t = document.createElement('div'); 
      t.className = `toast align-items-center text-bg-${type === 'success' ? 'success' : 'danger'} border-0 show`;
      t.innerHTML = `
        <div class='d-flex'>
          <div class='toast-body'><i class="fa fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'} me-2"></i>${msg}</div>
          <button type='button' class='btn-close btn-close-white me-2 m-auto' data-bs-dismiss='toast'></button>
        </div>
      `;
      cont.appendChild(t);
      setTimeout(() => { t.remove() }, delay);
    }

    async function apiCall(endpoint, options = {}) {
      try {
        const response = await fetch(`${API_BASE}/${endpoint}`, {
          headers: {
            'Accept': 'application/json',
            ...options.headers
          },
          ...options
        });
        
        const data = await response.json();
        return data;
      } catch (error) {
        console.error('API Call failed:', error);
        showToast('Network error: ' + error.message, 'error');
        return { status: 'error', message: 'Network error' };
      }
    }

    async function apiCallWithFormData(endpoint, formData) {
      return apiCall(endpoint, {
        method: 'POST',
        body: formData
      });
    }

    // Dashboard functions
    async function loadDashboardStats() {
      const data = await apiCall('dashboard-stats.php');
      
      if (data.status === 'success') {
        document.getElementById('totalUsers').textContent = data.data.total_users.toLocaleString();
        document.getElementById('totalProducts').textContent = data.data.total_products.toLocaleString();
        document.getElementById('totalOrders').textContent = data.data.total_orders.toLocaleString();
        document.getElementById('totalIncome').textContent = '₹' + parseFloat(data.data.total_income).toLocaleString('en-IN', {
          minimumFractionDigits: 2,
          maximumFractionDigits: 2
        });
        
        renderIncomeChart(data.data.monthly_income);
        renderRecentOrders();
      }
    }

    function renderIncomeChart(monthlyData) {
      const ctx = document.getElementById('incomeChart');
      const labels = monthlyData.map(item => {
        const [year, month] = item.month.split('-');
        return new Date(year, month - 1).toLocaleDateString('en-US', { month: 'short', year: '2-digit' });
      });
      const data = monthlyData.map(item => item.income);
      
      if (window.incomeChartInstance) {
        window.incomeChartInstance.destroy();
      }
      
      window.incomeChartInstance = new Chart(ctx, { 
        type: 'line', 
        data: { 
          labels, 
          datasets: [{ 
            label: 'Monthly Income', 
            data, 
            tension: 0.4, 
            fill: true, 
            borderWidth: 3,
            backgroundColor: 'rgba(44, 90, 160, 0.1)',
            borderColor: 'rgba(44, 90, 160, 1)',
            pointBackgroundColor: 'rgba(44, 90, 160, 1)',
            pointBorderColor: '#fff',
            pointBorderWidth: 3,
            pointRadius: 5,
            pointHoverRadius: 7
          }] 
        }, 
        options: { 
          responsive: true, 
          plugins: { 
            legend: { 
              display: false 
            },
            tooltip: {
              backgroundColor: 'rgba(255, 255, 255, 0.9)',
              titleColor: '#2d3748',
              bodyColor: '#4a5568',
              borderColor: '#e2e8f0',
              borderWidth: 1,
              padding: 12,
              boxPadding: 6,
              usePointStyle: true,
              callbacks: {
                label: function(context) {
                  return '₹' + context.parsed.y.toLocaleString('en-IN');
                }
              }
            }
          }, 
          scales: { 
            y: { 
              beginAtZero: true,
              grid: {
                color: 'rgba(0,0,0,0.05)'
              },
              ticks: {
                callback: function(value) {
                  return '₹' + value.toLocaleString('en-IN');
                }
              }
            },
            x: {
              grid: {
                display: false
              }
            }
          } 
        } 
      });
    }

    async function renderRecentOrders() {
      const data = await apiCall('view-orders.php');
      const list = document.getElementById('recentOrdersList');
      
      if (data.status === 'success' && data.data.length > 0) {
        const recentOrders = data.data.slice(0, 5);
        list.innerHTML = '';
        
        recentOrders.forEach(order => {
          const item = document.createElement('a');
          item.href = '#';
          item.className = 'list-group-item list-group-item-action';
          item.innerHTML = `
            <div class="d-flex w-100 justify-content-between align-items-start">
              <div class="flex-grow-1">
                <h6 class="mb-1">${order.order_number}</h6>
                <p class="mb-1 text-muted small">${order.first_name} ${order.last_name}</p>
                <div class="d-flex justify-content-between align-items-center">
                  <span class="badge ${getStatusClass(order.status)}">${order.status}</span>
                  <strong class="text-primary">₹${order.total_price}</strong>
                </div>
              </div>
            </div>
          `;
          list.appendChild(item);
        });
      } else {
        list.innerHTML = '<div class="text-center p-4 text-muted"><i class="fa fa-inbox fa-2x mb-2"></i><div>No recent orders</div></div>';
      }
    }

    function getStatusClass(status) {
      const statusClasses = {
        'Placed': 'badge-plated',
        'Packaging': 'badge-packaging',
        'Transported': 'badge-transported',
        'Delivered': 'badge-delivered',
        'Cancelled': 'badge-cancelled',
        'Returned': 'badge-returned'
      };
      return statusClasses[status] || 'badge-secondary';
    }

    // Products functions
    async function loadProducts() {
      const data = await apiCall('fetch-products.php');
      const tbody = document.querySelector('#productsTable tbody'); 
      
      if (data.status === 'success' && data.products.length > 0) {
        tbody.innerHTML = '';
        
        data.products.forEach((product, index) => {
          const tr = document.createElement('tr');
          const mainImage = product.images && product.images[0] ? 
            `<img src="${API_BASE.replace('/admin', '')}/${product.images[0]}" class="img-preview" />` : 
            '<div class="img-preview d-flex align-items-center justify-content-center bg-light text-muted"><i class="fa fa-image fa-lg"></i></div>';
          
          const stockClass = product.stock > 20 ? 'stock-high' : product.stock > 5 ? 'stock-medium' : 'stock-low';
          
          tr.innerHTML = `
            <td>${index + 1}</td>
            <td>${mainImage}</td>
            <td>
              <div class="fw-semibold">${product.name}</div>
              <small class="text-muted">${product.brand || 'No brand'}</small>
            </td>
            <td>
              <div class="fw-bold text-primary">₹${product.price}</div>
              ${product.discounted_price ? `<small class="text-success">₹${product.discounted_price}</small>` : ''}
            </td>
            <td>${product.offer_percent ? `<span class="badge bg-success">${product.offer_percent}% OFF</span>` : '<span class="text-muted">-</span>'}</td>
            <td><span class="badge bg-light text-dark">${product.category}</span></td>
            <td><span class="stock-display ${stockClass}">${product.stock}</span></td>
            <td><span class="badge ${product.stock > 0 ? 'bg-success' : 'bg-danger'}">${product.stock > 0 ? 'In Stock' : 'Out of Stock'}</span></td>
            <td>
              <div class="btn-group btn-group-sm">
                <button class='btn btn-outline-primary btn-edit' data-id='${product.product_id}' title="Edit"><i class='fa fa-edit'></i></button>
                <button class='btn btn-outline-danger btn-delete' data-id='${product.product_id}' title="Delete"><i class='fa fa-trash'></i></button>
              </div>
            </td>
          `;
          tbody.appendChild(tr);
        });
      } else {
        tbody.innerHTML = `<tr><td colspan="9" class="text-center py-5 text-muted">
          <i class="fa fa-box-open fa-3x mb-3"></i>
          <div>No products found. Add your first product to get started.</div>
        </td></tr>`;
      }
    }

    async function saveProduct(formData, isEdit = false) {
      const endpoint = isEdit ? 'edit-product.php' : 'add-product.php';
      const data = await apiCallWithFormData(endpoint, formData);
      
      if (data.status === 'success') {
        showToast(data.message);
        loadProducts();
        loadDashboardStats();
        bootstrap.Modal.getInstance(document.getElementById('productModal')).hide();
        document.getElementById('productForm').reset();
        document.getElementById('imagePreview').innerHTML = '';
      } else {
        showToast(data.message, 'error');
      }
    }

    async function deleteProduct(productId) {
      if (!confirm('Are you sure you want to delete this product? This action cannot be undone.')) return;
      
      const formData = new FormData();
      formData.append('product_id', productId);
      
      const data = await apiCallWithFormData('delete-product.php', formData);
      
      if (data.status === 'success') {
        showToast(data.message);
        loadProducts();
        loadDashboardStats();
      } else {
        showToast(data.message, 'error');
      }
    }

    // Customers functions
    async function loadCustomers() {
      const data = await apiCall('view-customers.php');
      const tbody = document.querySelector('#customersTable tbody'); 
      
      if (data.status === 'success' && data.data.length > 0) {
        tbody.innerHTML = '';
        
        data.data.forEach((customer, index) => {
          const tr = document.createElement('tr');
          const joinDate = new Date(customer.created_at).toLocaleDateString('en-IN');
          
          tr.innerHTML = `
            <td>${index + 1}</td>
            <td>
              <div class="fw-semibold">${customer.first_name} ${customer.last_name}</div>
              <small class="text-muted">${customer.gender || 'Not specified'}</small>
            </td>
            <td>${customer.mobile_no}</td>
            <td>${customer.email || '<span class="text-muted">No email</span>'}</td>
            <td><small class="text-muted">${joinDate}</small></td>
            <td>
              <div class="btn-group btn-group-sm">
                <button class='btn btn-outline-primary edit-cust' data-id='${customer.user_id}' title="Edit"><i class='fa fa-edit'></i></button> 
                <button class='btn btn-outline-danger del-cust' data-id='${customer.user_id}' title="Delete"><i class='fa fa-trash'></i></button>
              </div>
            </td>`;
          tbody.appendChild(tr);
        });
      } else {
        tbody.innerHTML = `<tr><td colspan="6" class="text-center py-5 text-muted">
          <i class="fa fa-users fa-3x mb-3"></i>
          <div>No customers found. Customers will appear here once they register.</div>
        </td></tr>`;
      }
    }

    async function saveCustomer(formData, isEdit = false) {
      const data = await apiCallWithFormData(isEdit ? 'edit-customer.php' : 'add-customer.php', formData);
      
      if (data.status === 'success') {
        showToast(data.message);
        loadCustomers();
        loadDashboardStats();
        bootstrap.Modal.getInstance(document.getElementById('customerModal')).hide();
        document.getElementById('customerForm').reset();
      } else {
        showToast(data.message, 'error');
      }
    }

    async function deleteCustomer(userId) {
      if (!confirm('Are you sure you want to delete this customer? This will remove all their data.')) return;
      
      const formData = new FormData();
      formData.append('user_id', userId);
      
      const data = await apiCallWithFormData('delete-customer.php', formData);
      
      if (data.status === 'success') {
        showToast(data.message);
        loadCustomers();
        loadDashboardStats();
      } else {
        showToast(data.message, 'error');
      }
    }

    // Ads functions
    async function loadAds() {
      const data = await apiCall('view-ads.php');
      const wrap = document.getElementById('adsList'); 
      
      if (data.status === 'success' && data.data.length > 0) {
        wrap.innerHTML = '';
        
        data.data.forEach(ad => {
          const col = document.createElement('div'); 
          const card = document.createElement('div'); 
          card.className = 'ad-card';
          card.innerHTML = `
            <img src="${API_BASE.replace('/admin', '')}/${ad.image_path}" class="card-img-top" style="height: 160px; object-fit: cover;">
            <div class="ad-card-body">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <small class="text-muted">${new Date(ad.created_at).toLocaleDateString()}</small>
                <span class="badge ${ad.is_active ? 'bg-success' : 'bg-secondary'}">${ad.is_active ? 'Active' : 'Inactive'}</span>
              </div>
              <a href="${ad.link || '#'}" target="_blank" class="text-truncate d-block text-primary mb-3">${ad.link || 'No destination link'}</a>
              <div class="d-grid">
                <button class="btn btn-sm btn-outline-danger del-ad" data-id="${ad.ad_id}">Remove Ad</button>
              </div>
            </div>`;
          wrap.appendChild(card);
        });
      } else {
        wrap.innerHTML = '<div class="col-12 text-center py-5 text-muted"><i class="fa fa-ad fa-3x mb-3"></i><div>No ads posted yet. Create your first ad campaign.</div></div>';
      }
    }

    async function saveAd(formData) {
      const data = await apiCallWithFormData('add-ad.php', formData);
      
      if (data.status === 'success') {
        showToast(data.message);
        loadAds();
        bootstrap.Modal.getInstance(document.getElementById('adModal')).hide();
        document.getElementById('adForm').reset();
        document.getElementById('adPreview').classList.add('d-none');
      } else {
        showToast(data.message, 'error');
      }
    }

    async function deleteAd(adId) {
      if (!confirm('Are you sure you want to delete this advertisement?')) return;
      
      const formData = new FormData();
      formData.append('ad_id', adId);
      
      const data = await apiCallWithFormData('delete-ad.php', formData);
      
      if (data.status === 'success') {
        showToast(data.message);
        loadAds();
      } else {
        showToast(data.message, 'error');
      }
    }

    // Announcements functions
    async function loadAnnouncements() {
      const data = await apiCall('view-announcements.php');
      const annList = document.getElementById('announcementsList'); 
      
      if (data.status === 'success' && data.data.length > 0) {
        annList.innerHTML = '';
        
        data.data.forEach(announcement => { 
          const div = document.createElement('div'); 
          div.className = 'announcement-item'; 
          div.innerHTML = `
            <div class="d-flex justify-content-between align-items-start">
              <div class="me-3 flex-grow-1">
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <strong class="text-primary">Announcement</strong>
                  <small class="text-muted">${new Date(announcement.created_at).toLocaleString()}</small>
                </div>
                <div class="mb-2">${announcement.message}</div>
                <div class="d-flex align-items-center">
                  <span class="badge ${announcement.is_active ? 'bg-success' : 'bg-secondary'} me-2">${announcement.is_active ? 'Active' : 'Inactive'}</span>
                  <small class="text-muted">ID: ${announcement.announcement_id}</small>
                </div>
              </div>
              <button class='btn btn-sm btn-outline-danger del-ann' data-id='${announcement.announcement_id}' title="Delete"><i class='fa fa-trash'></i></button>
            </div>`; 
          annList.appendChild(div); 
        });
      } else {
        annList.innerHTML = '<div class="text-center py-5 text-muted"><i class="fa fa-bullhorn fa-3x mb-3"></i><div>No announcements posted yet. Keep your customers informed!</div></div>';
      }
    }

    async function saveAnnouncement(formData) {
      const data = await apiCallWithFormData('add-announcement.php', formData);
      
      if (data.status === 'success') {
        showToast(data.message);
        loadAnnouncements();
        bootstrap.Modal.getInstance(document.getElementById('announcementModal')).hide();
        document.getElementById('announcementForm').reset();
      } else {
        showToast(data.message, 'error');
      }
    }

    async function deleteAnnouncement(announcementId) {
      if (!confirm('Are you sure you want to delete this announcement?')) return;
      
      const formData = new FormData();
      formData.append('announcement_id', announcementId);
      
      const data = await apiCallWithFormData('delete-announcement.php', formData);
      
      if (data.status === 'success') {
        showToast(data.message);
        loadAnnouncements();
      } else {
        showToast(data.message, 'error');
      }
    }

    // Messages functions
    async function loadMessages() {
      const data = await apiCall('view-customer-messages.php');
      const tbody = document.querySelector('#messagesTable tbody'); 
      
      if (data.status === 'success' && data.data.length > 0) {
        tbody.innerHTML = '';
        
        data.data.forEach((message, index) => {
          const tr = document.createElement('tr'); 
          const messagePreview = message.message.length > 50 ? 
            message.message.substring(0, 50) + '...' : message.message;
          const messageDate = new Date(message.created_at).toLocaleDateString();
          
          tr.innerHTML = `
            <td>${index + 1}</td>
            <td>
              <div class="fw-semibold">${message.first_name} ${message.last_name}</div>
              <small class="text-muted">Customer</small>
            </td>
            <td>
              <div>${message.email || 'No email'}</div>
              <small class="text-muted">${message.mobile_no}</small>
            </td>
            <td title="${message.message}">${messagePreview}</td>
            <td><small class="text-muted">${messageDate}</small></td>
            <td>
              <button class='btn btn-sm btn-outline-danger del-msg' data-id='${message.message_id}' title="Delete"><i class='fa fa-trash'></i></button>
            </td>`; 
          tbody.appendChild(tr);
        });
      } else {
        tbody.innerHTML = '<tr><td colspan="6" class="text-center py-5 text-muted"><i class="fa fa-envelope fa-3x mb-3"></i><div>No customer messages yet.</div></td></tr>';
      }
    }

    async function sendBroadcast(formData) {
      const data = await apiCallWithFormData('send-public-message.php', formData);
      
      if (data.status === 'success') {
        showToast(data.message);
        document.getElementById('sendMessageForm').reset();
      } else {
        showToast(data.message, 'error');
      }
    }

    async function sendPrivateMessage(formData) {
      const data = await apiCallWithFormData('send-private-message.php', formData);
      
      if (data.status === 'success') {
        showToast(data.message);
        bootstrap.Modal.getInstance(document.getElementById('sendToCustomerModal')).hide();
        document.getElementById('sendToCustomerForm').reset();
      } else {
        showToast(data.message, 'error');
      }
    }

    // Orders functions
    async function loadOrders() {
      const data = await apiCall('view-orders.php');
      const tbody = document.querySelector('#ordersTable tbody'); 
      
      if (data.status === 'success' && data.data.length > 0) {
        tbody.innerHTML = '';
        
        data.data.forEach((order, index) => {
          const tr = document.createElement('tr');
          const orderDate = new Date(order.created_at).toLocaleDateString();
          
          tr.innerHTML = `
            <td>${index + 1}</td>
            <td>
              <div class="fw-semibold">${order.order_number}</div>
              <small class="text-muted">ID: ${order.order_id}</small>
            </td>
            <td>
              <div class="fw-semibold">${order.first_name} ${order.last_name}</div>
              <small class="text-muted">${order.mobile_no}</small>
            </td>
            <td>
              <div>${order.product_name}</div>
              <small class="text-muted">Qty: ${order.quantity}</small>
            </td>
            <td>
              <div class="fw-bold text-success">₹${order.total_price}</div>
              ${order.offer_percent > 0 ? `<small class="text-danger">${order.offer_percent}% off</small>` : ''}
            </td>
            <td><span class='badge badge-status ${getStatusClass(order.status)}'>${order.status}</span></td>
            <td><small class="text-muted">${orderDate}</small></td>
            <td>
              <div class="btn-group btn-group-sm">
                ${order.status !== 'Delivered' && order.status !== 'Cancelled' && order.status !== 'Returned' ? 
                  `<button class='btn btn-outline-primary advance-order' data-id='${order.order_id}' data-status='${order.status}' title="Advance Status"><i class='fa fa-arrow-right'></i></button>` : ''}
                ${order.status === 'Transported' ? 
                  `<button class='btn btn-outline-success deliver-order' data-id='${order.order_id}' title="Mark as Delivered"><i class='fa fa-check'></i></button>` : ''}
              </div>
            </td>`;
          tbody.appendChild(tr);
        });
      } else {
        tbody.innerHTML = '<tr><td colspan="8" class="text-center py-5 text-muted"><i class="fa fa-shopping-cart fa-3x mb-3"></i><div>No orders placed yet. Orders will appear here when customers make purchases.</div></td></tr>';
      }
    }

    async function updateOrderStatus(orderId, status, otp = '') {
      const formData = new FormData();
      formData.append('order_id', orderId);
      formData.append('status', status);
      if (otp) {
        formData.append('delivery_otp', otp);
      }
      
      const data = await apiCallWithFormData('update-status.php', formData);
      
      if (data.status === 'success') {
        showToast(data.message);
        loadOrders();
        loadDashboardStats();
      } else {
        showToast(data.message, 'error');
      }
    }

    // Populate customer dropdown for sending messages
    async function populateCustomerDropdown() {
      const select = document.getElementById('selectedCustomer');
      const data = await apiCall('view-customers.php');
      
      select.innerHTML = '<option value="">-- Select Customer --</option>';
      
      if (data.status === 'success' && data.data.length > 0) {
        data.data.forEach(customer => {
          const option = document.createElement('option');
          option.value = customer.user_id;
          option.textContent = `${customer.first_name} ${customer.last_name} (${customer.email || customer.mobile_no})`;
          select.appendChild(option);
        });
      }
    }

    // Set current date
    function setCurrentDate() {
      const now = new Date();
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      document.getElementById('currentDate').textContent = now.toLocaleDateString('en-IN', options);
    }

    // Mobile menu toggle
    function toggleMobileMenu() {
      const sidebar = document.getElementById('sidebar');
      sidebar.classList.toggle('mobile-open');
    }

    // Event Listeners
    document.addEventListener('DOMContentLoaded', () => {
      setCurrentDate();
      loadDashboardStats();
      loadProducts();
      loadCustomers();
      loadAds();
      loadAnnouncements();
      loadMessages();
      loadOrders();

      // Mobile menu button
      document.getElementById('mobileMenuBtn').addEventListener('click', toggleMobileMenu);

      // Close mobile menu when clicking on a link
      document.querySelectorAll('.sidebar .nav-link').forEach(link => {
        link.addEventListener('click', () => {
          if (window.innerWidth < 992) {
            toggleMobileMenu();
          }
        });
      });

      // Refresh data button
      document.getElementById('refreshDataBtn').addEventListener('click', () => {
        loadDashboardStats();
        loadProducts();
        loadCustomers();
        loadAds();
        loadAnnouncements();
        loadMessages();
        loadOrders();
        showToast('All data has been refreshed successfully');
      });

      // Refresh stats button
      document.getElementById('refreshStatsBtn').addEventListener('click', () => {
        loadDashboardStats();
        showToast('Dashboard statistics updated');
      });

      // Product image preview
      document.getElementById('productImages').addEventListener('change', (e) => {
        const files = Array.from(e.target.files).slice(0, 5);
        const preview = document.getElementById('imagePreview'); 
        preview.innerHTML = '';
        
        files.forEach(f => {
          const reader = new FileReader(); 
          reader.onload = (ev) => { 
            const img = document.createElement('img'); 
            img.src = ev.target.result; 
            img.className = 'img-preview me-2 mb-2'; 
            preview.appendChild(img); 
          }; 
          reader.readAsDataURL(f);
        });
      });

      // Save product
      document.getElementById('productForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const saveBtn = document.getElementById('saveProductBtn');
        saveBtn.disabled = true;
        saveBtn.innerHTML = '<span class="spinner"></span> Saving...';
        
        const formData = new FormData(e.target);
        const productId = document.getElementById('productId').value;
        const isEdit = !!productId;
        
        if (isEdit) {
          formData.append('product_id', productId);
        }
        
        await saveProduct(formData, isEdit);
        
        saveBtn.disabled = false;
        saveBtn.innerHTML = 'Save Product';
      });

      // Product table actions
      document.querySelector('#productsTable').addEventListener('click', async (e) => {
        const id = e.target.closest('[data-id]')?.dataset?.id;
        if (!id) return;
        
        if (e.target.closest('.btn-delete')) {
          await deleteProduct(id);
        } else if (e.target.closest('.btn-edit')) {
          // Load product data for editing
          try {
            const data = await apiCall('fetch-products.php');
            if (data.status === 'success') {
              const product = data.products.find(p => p.product_id == id);
              if (product) {
                document.getElementById('productModalTitle').textContent = 'Edit Product';
                document.getElementById('productId').value = product.product_id;
                document.getElementById('productName').value = product.name;
                document.getElementById('productPrice').value = product.price;
                document.getElementById('productOffer').value = product.offer_percent || '';
                document.getElementById('productBrand').value = product.brand || '';
                document.getElementById('productCategory').value = product.category || '';
                document.getElementById('productColors').value = product.color || '';
                document.getElementById('productMaterials').value = product.material || '';
                document.getElementById('productSizes').value = product.available_sizes || '';
                document.getElementById('productStock').value = product.stock || 0;
                document.getElementById('productDesc').value = product.description || '';
                
                const preview = document.getElementById('imagePreview');
                preview.innerHTML = '';
                (product.images || []).forEach(src => {
                  const img = document.createElement('img');
                  img.src = `${API_BASE.replace('/admin', '')}/${src}`;
                  img.className = 'img-preview me-2 mb-2';
                  preview.appendChild(img);
                });
                
                new bootstrap.Modal(document.getElementById('productModal')).show();
              } else {
                showToast('Product not found', 'error');
              }
            }
          } catch (error) {
            console.error('Error loading product for edit:', error);
            showToast('Failed to load product data', 'error');
          }
        }
      });

      // Customer form
      document.getElementById('customerForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const customerId = document.getElementById('customerId').value;
        const isEdit = !!customerId;
        
        if (isEdit) {
          formData.append('user_id', customerId);
        }
        
        await saveCustomer(formData, isEdit);
      });

      // Customer table actions
      document.querySelector('#customersTable').addEventListener('click', async (e) => {
        const id = e.target.closest('[data-id]')?.dataset?.id;
        if (!id) return;
        
        if (e.target.closest('.edit-cust')) {
          const data = await apiCall('view-customers.php');
          if (data.status === 'success') {
            const customer = data.data.find(c => c.user_id == id);
            if (customer) {
              document.getElementById('customerId').value = customer.user_id;
              document.getElementById('custFname').value = customer.first_name;
              document.getElementById('custLname').value = customer.last_name;
              document.getElementById('custMobile').value = customer.mobile_no;
              document.getElementById('custEmail').value = customer.email || '';
              document.getElementById('custPassword').required = false;
              document.querySelector('#customerModal .modal-title').textContent = 'Edit Customer';
              new bootstrap.Modal(document.getElementById('customerModal')).show();
            }
          }
        } else if (e.target.closest('.del-cust')) {
          await deleteCustomer(id);
        }
      });

      // Ad preview
      document.getElementById('adImage').addEventListener('change', async (e) => {
        const f = e.target.files[0];
        if (!f) return;
        
        const reader = new FileReader();
        reader.onload = (ev) => {
          const img = document.getElementById('adPreview');
          img.src = ev.target.result;
          img.classList.remove('d-none');
        };
        reader.readAsDataURL(f);
      });

      // Post ad
      document.getElementById('adForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        await saveAd(formData);
      });

      // Delete ad
      document.getElementById('adsList').addEventListener('click', async (e) => {
        const id = e.target.closest('[data-id]')?.dataset?.id;
        if (!id) return;
        
        if (e.target.closest('.del-ad')) {
          await deleteAd(id);
        }
      });

      // Announcement
      document.getElementById('announcementForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        await saveAnnouncement(formData);
      });

      // Delete announcement
      document.getElementById('announcementsList').addEventListener('click', async (e) => {
        const id = e.target.closest('[data-id]')?.dataset?.id;
        if (!id) return;
        
        if (e.target.closest('.del-ann')) {
          await deleteAnnouncement(id);
        }
      });

      // Send broadcast from form
      document.getElementById('sendMessageForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData();
        formData.append('subject', document.getElementById('messageSubject').value);
        formData.append('message', document.getElementById('messageBody').value);
        
        await sendBroadcast(formData);
      });

      // Send broadcast quick button
      document.getElementById('sendBroadcastBtn').addEventListener('click', () => {
        const subject = prompt('Message subject:');
        if (subject === null) return;
        
        const message = prompt('Message text to broadcast to all customers:');
        if (message === null) return;
        
        const formData = new FormData();
        formData.append('subject', subject);
        formData.append('message', message);
        
        sendBroadcast(formData);
      });

      // Send to customer button
      document.getElementById('sendToCustomerBtn').addEventListener('click', async () => {
        await populateCustomerDropdown();
        new bootstrap.Modal(document.getElementById('sendToCustomerModal')).show();
      });

      // Send to customer form
      document.getElementById('sendToCustomerForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        await sendPrivateMessage(formData);
      });

      // Orders actions
      document.getElementById('ordersTable').addEventListener('click', async (e) => {
        const id = e.target.closest('[data-id]')?.dataset?.id;
        if (!id) return;
        
        if (e.target.closest('.advance-order')) {
          const currentStatus = e.target.closest('[data-status]').dataset.status;
          const statusFlow = {
            'Placed': 'Packaging',
            'Packaging': 'Transported'
          };
          
          if (statusFlow[currentStatus]) {
            await updateOrderStatus(id, statusFlow[currentStatus]);
          } else {
            showToast('Cannot advance order from current status', 'error');
          }
        } else if (e.target.closest('.deliver-order')) {
          // Show OTP modal for delivery confirmation
          const data = await apiCall('view-orders.php');
          if (data.status === 'success') {
            const order = data.data.find(o => o.order_id == id);
            if (order) {
              document.getElementById('otpModal').dataset.orderid = id;
              document.getElementById('otpInfo').textContent = 
                `Order ${order.order_number} for ${order.first_name} ${order.last_name}. Enter OTP sent to customer to confirm delivery.`;
              new bootstrap.Modal(document.getElementById('otpModal')).show();
            }
          }
        }
      });

      // Confirm OTP
      document.getElementById('confirmOtpBtn').addEventListener('click', async () => {
        const otp = document.getElementById('otpInput').value.trim();
        const orderId = document.getElementById('otpModal').dataset.orderid;
        
        if (!otp) {
          alert('Please enter OTP');
          return;
        }
        
        await updateOrderStatus(orderId, 'Delivered', otp);
        bootstrap.Modal.getInstance(document.getElementById('otpModal')).hide();
        document.getElementById('otpInput').value = '';
      });

      // Reset product form when adding new product
      document.getElementById('addProductBtn').addEventListener('click', () => {
        document.getElementById('productModalTitle').textContent = 'Add New Product';
        document.getElementById('productId').value = '';
        document.getElementById('productForm').reset();
        document.getElementById('imagePreview').innerHTML = '';
      });

      // Reset customer form when adding new customer
      document.getElementById('addCustomerBtn').addEventListener('click', () => {
        document.getElementById('customerId').value = '';
        document.getElementById('customerForm').reset();
        document.getElementById('custPassword').required = true;
        document.querySelector('#customerModal .modal-title').textContent = 'Add New Customer';
      });

    });

  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>